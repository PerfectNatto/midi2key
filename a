option(ENABLE_ASAN "Build with AddressSanitizer" ON)

if(ENABLE_ASAN AND (CMAKE_CXX_COMPILER_ID MATCHES "Clang|GNU"))
  # -O1 推奨 (-O0 は遅く、-O2 以上は最適化でスタックフレームが潰れる)
  set(ASAN_FLAGS "-fsanitize=address -fno-omit-frame-pointer -O1 -g")
  add_compile_options(${ASAN_FLAGS})
  add_link_options(${ASAN_FLAGS})
endif()
