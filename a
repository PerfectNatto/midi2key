import os
import boto3
from tqdm import tqdm

def upload_folder_to_s3_with_progress(local_folder: str, bucket_name: str, s3_prefix: str = ""):
    """
    local_folder: ローカルのフォルダパス
    bucket_name: アップロード先の S3 バケット名
    s3_prefix:   バケット内のプレフィックス (末尾スラッシュ不要)
    """
    s3 = boto3.client('s3')

    # 1. アップロード対象のファイルリストを作成
    files_to_upload = []
    for root, _, files in os.walk(local_folder):
        for fname in files:
            local_path = os.path.join(root, fname)
            rel_path = os.path.relpath(local_path, local_folder).replace("\\", "/")
            s3_key = f"{s3_prefix}/{rel_path}" if s3_prefix else rel_path
            files_to_upload.append((local_path, s3_key))

    # 2. tqdm でファイル数ベースのプログレスバーを表示しつつアップロード
    for local_path, s3_key in tqdm(files_to_upload, desc="Uploading to S3", unit="file"):
        s3.upload_file(local_path, bucket_name, s3_key)

if __name__ == "__main__":
    upload_folder_to_s3_with_progress(
        local_folder="/path/to/myfolder",
        bucket_name="your-bucket-name",
        s3_prefix="optional/subfolder"
    )
